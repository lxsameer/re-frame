
<!DOCTYPE HTML>
<html lang="en" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Flow Mechanics Â· re-frame</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.2">
        
        
        
    
    <link rel="stylesheet" href="gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">

    
    
    <link rel="prev" href="SubscriptionsCleanup.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        <li class="header">description: re-frame official documentation</li>
        
        
    
        <li class="chapter " data-level="1.1" data-path="./">
            
                <a href="./">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Derived Values, Flowing</li>
        
        
    
        <li class="chapter " data-level="2.1" data-path="../">
            
                <a href="../">
            
                    
                    This Repo's README
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="ApplicationState.html">
            
                <a href="ApplicationState.html">
            
                    
                    app-db (Application State)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3" data-path="CodeWalkthrough.html">
            
                <a href="CodeWalkthrough.html">
            
                    
                    First Code Walk-Through
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.4" data-path="API.html">
            
                <a href="API.html">
            
                    
                    The API
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.5" data-path="MentalModelOmnibus.html">
            
                <a href="MentalModelOmnibus.html">
            
                    
                    Mental Model Omnibus
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Alternative Introductions</li>
        
        
    
        <li class="chapter " data-level="3.1" >
            
                <a target="_blank" href="https://purelyfunctional.tv/guide/re-frame-building-blocks/">
            
                    
                    purelyfunctional.tv
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2" >
            
                <a target="_blank" href="https://lambdaisland.com/episodes">
            
                    
                    Lambda Island Videos
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Dominoes 2 and 3 - Event Handlers</li>
        
        
    
        <li class="chapter " data-level="4.1" data-path="EventHandlingInfographic.html">
            
                <a href="EventHandlingInfographic.html">
            
                    
                    Infographic Overview
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.2" data-path="EffectfulHandlers.html">
            
                <a href="EffectfulHandlers.html">
            
                    
                    Effectful Handlers
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.3" data-path="Interceptors.html">
            
                <a href="Interceptors.html">
            
                    
                    Interceptors
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.4" data-path="Effects.html">
            
                <a href="Effects.html">
            
                    
                    Effects
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.5" data-path="Coeffects.html">
            
                <a href="Coeffects.html">
            
                    
                    Coeffects
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Domino 4 - Subscriptions</li>
        
        
    
        <li class="chapter " data-level="5.1" data-path="SubscriptionInfographic.html">
            
                <a href="SubscriptionInfographic.html">
            
                    
                    Infographic
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.2" data-path="SubscriptionsCleanup.html">
            
                <a href="SubscriptionsCleanup.html">
            
                    
                    Correcting a wrong
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="5.3" data-path="SubscriptionFlow.html">
            
                <a href="SubscriptionFlow.html">
            
                    
                    Flow Mechanics
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Domino 5 - Reagent Tutorials</li>
        
        
    
        <li class="chapter " data-level="6.1" >
            
                <a target="_blank" href="https://github.com/Day8/re-frame/wiki#reagent-tutorials">
            
                    
                    The Basics
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.2" >
            
                <a target="_blank" href="https://lambdaisland.com/episodes">
            
                    
                    Lambda Island Videos
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.3" >
            
                <a target="_blank" href="https://purelyfunctional.tv/guide/reagent/">
            
                    
                    purelyfunctional.tv 
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.4" >
            
                <a target="_blank" href="http://timothypratley.blogspot.com.au/p/p.html">
            
                    
                    Reagent Deep Dive Series from Timothy Pratley
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.5" >
            
                <a target="_blank" href="https://www.martinklepsch.org/posts/props-children-and-component-lifecycle-in-reagent.html">
            
                    
                    Props, Children & Component Lifecycle
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">App Structure</li>
        
        
    
        <li class="chapter " data-level="7.1" data-path="Basic-App-Structure.html">
            
                <a href="Basic-App-Structure.html">
            
                    
                    Basic App Structure
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="7.2" data-path="Navigation.html">
            
                <a href="Navigation.html">
            
                    
                    Navigation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="7.3" data-path="Namespaced-Keywords.html">
            
                <a href="Namespaced-Keywords.html">
            
                    
                    Namespaced Keywords
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">App Data</li>
        
        
    
        <li class="chapter " data-level="8.1" data-path="Loading-Initial-Data.html">
            
                <a href="Loading-Initial-Data.html">
            
                    
                    Loading Initial Data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="8.2" data-path="Talking-To-Servers.html">
            
                <a href="Talking-To-Servers.html">
            
                    
                    Talking To Servers
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="8.3" data-path="Subscribing-To-External-Data.html">
            
                <a href="Subscribing-To-External-Data.html">
            
                    
                    Subscribing to External Data
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Debugging And Testing</li>
        
        
    
        <li class="chapter " data-level="9.1" data-path="Debugging-Event-Handlers.html">
            
                <a href="Debugging-Event-Handlers.html">
            
                    
                    Debugging Event Handlers
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="9.2" data-path="Debugging.html">
            
                <a href="Debugging.html">
            
                    
                    Debugging
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="9.3" data-path="Testing.html">
            
                <a href="Testing.html">
            
                    
                    Testing
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Miscellaneous</li>
        
        
    
        <li class="chapter " data-level="10.1" data-path="FAQs/">
            
                <a href="FAQs/">
            
                    
                    FAQs
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="10.2" data-path="External-Resources.html">
            
                <a href="External-Resources.html">
            
                    
                    External Resources
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="10.3" data-path="Performance-Problems.html">
            
                <a href="Performance-Problems.html">
            
                    
                    Eek! Performance Problems
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="10.4" data-path="Solve-the-CPU-hog-problem.html">
            
                <a href="Solve-the-CPU-hog-problem.html">
            
                    
                    Solve the CPU hog problem
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="10.5" data-path="Using-Stateful-JS-Components.html">
            
                <a href="Using-Stateful-JS-Components.html">
            
                    
                    Using Stateful JS Components
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="10.6" data-path="The-re-frame-logo.html">
            
                <a href="The-re-frame-logo.html">
            
                    
                    The re-frame Logo
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="10.7" data-path="Code-Of-Conduct.html">
            
                <a href="Code-Of-Conduct.html">
            
                    
                    Code Of Conduct
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="." >Flow Mechanics</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <blockquote>
<p>In a rush? You can get away with skipping this page on the first pass. <br>
Next page: <a href="Basic-App-Structure.html">Basic App Structure</a></p>
</blockquote>
<h2 id="flow-mechanics">Flow Mechanics</h2>
<p>This tutorial explains the underlying reactive mechanism used in dominoes 4-5-6. It goes on to introduce <code>re-frame.core/reg-sub-raw</code>.</p>
<h2 id="on-flow">On Flow</h2>
<p>Arguments from authority ...</p>
<blockquote>
<p>Everything flows, nothing stands still.   (Panta rhei)</p>
<p>No man ever steps in the same river twice for it&apos;s not the same river and he&apos;s not the same man.</p>
</blockquote>
<p><a href="http://en.wikiquote.org/wiki/Heraclitus" target="_blank">Heraclitus 500 BC</a>. Who, being Greek, had never seen a frozen river. <a href="http://farm6.static.flickr.com/5213/5477602206_ecb78559ed.jpg" target="_blank">alt version</a>.</p>
<blockquote>
<p>Think of an experience from your childhood. Something you remember clearly, something you can see,
feel, maybe even smell, as if you were really there. After all you really were there at the time,
weren&#x2019;t you? How else could you remember it? But here is the bombshell: you weren&#x2019;t there. Not a
single atom that is in your body today was there when that event took place .... Matter flows
from place to place and momentarily comes together to be you. Whatever you are, therefore, you
are not the stuff of which you are made. If that does not make the hair stand up on the back of
your neck, read it again until it does, because it is important.</p>
</blockquote>
<p>Steve Grand</p>
<h3 id="how-flow-happens-in-reagent">How Flow Happens In Reagent</h3>
<p>To implement a reactive flow, Reagent provides a <code>ratom</code> and a <code>reaction</code>.
re-frame uses both of these building blocks, so let&apos;s now make sure we understand them.</p>
<p><code>ratoms</code> behave just like normal ClojureScript atoms. You can <code>swap!</code> and <code>reset!</code> them, <code>watch</code> them, etc.</p>
<p>From a ClojureScript perspective, the purpose of an atom is to hold mutable data.  From a re-frame
perspective, we&apos;ll tweak that paradigm slightly and <strong>view a <code>ratom</code> as having a value that
changes over time.</strong>  Seems like a subtle distinction, I know, but because of it, re-frame sees a
<code>ratom</code> as a Signal. </p>
<p>A Signal is a value that changes over time.  So it is a stream of values. Each time a ratom gets
<code>reset!</code> that&apos;s a new value in the stream. </p>
<p>The 2nd building block, <code>reaction</code>, acts a bit like a function. It&apos;s a macro which wraps some
<code>computation</code> (a block of code) and returns a <code>ratom</code> holding the result of that <code>computation</code>.</p>
<p>The magic thing about a <code>reaction</code> is that the <code>computation</code> it wraps will be automatically
re-run  whenever &apos;its inputs&apos; change, producing a new output (return) value.</p>
<p>Eh, how?</p>
<p>Well, the <code>computation</code> is just a block of code, and if that code dereferences one or
more <code>ratoms</code>, it will be automatically re-run (recomputing a new return value) whenever any
of these dereferenced <code>ratoms</code> change.</p>
<p>To put that yet another way, a <code>reaction</code> detects a <code>computation&apos;s</code> input Signals (aka input <code>ratoms</code>)
and it will <code>watch</code> them, and when, later, it detects a change in one of them,  it will re-run that
computation, and it will <code>reset!</code> the new result of that computation into the <code>ratom</code> originally returned.</p>
<p>So, the <code>ratom</code> returned by a <code>reaction</code> is itself a Signal. Its value will change over time when
the <code>computation</code> is re-run.</p>
<p>So, via the interplay between <code>ratoms</code> and <code>reactions</code>,  values &apos;flow&apos; into computations and out
again, and then into further computations, etc.  &quot;Values&quot; flow (propagate) through the Signal graph.</p>
<p>But this Signal graph must be without cycles, because cycles cause mayhem!  re-frame achieves
a unidirectional flow.</p>
<p>Right, so that was a lot of words. Some code to clarify:</p>
<pre><code class="lang-Clojure">(<span class="hljs-name"><span class="hljs-builtin-name">ns</span></span> example1
 (<span class="hljs-symbol">:require-macros</span> [reagent.ratom <span class="hljs-symbol">:refer</span> [reaction]])  <span class="hljs-comment">;; reaction is a macro</span>
 (<span class="hljs-symbol">:require</span>        [reagent.core  <span class="hljs-symbol">:as</span>    reagent]))

(<span class="hljs-name"><span class="hljs-builtin-name">def</span></span> app-db  (<span class="hljs-name">reagent/atom</span> {<span class="hljs-symbol">:a</span> <span class="hljs-number">1</span>}))           <span class="hljs-comment">;; our root ratom  (signal)</span>

(<span class="hljs-name"><span class="hljs-builtin-name">def</span></span> ratom2  (<span class="hljs-name">reaction</span> {<span class="hljs-symbol">:b</span> (<span class="hljs-symbol">:a</span> @app-db)}))    <span class="hljs-comment">;; reaction wraps a computation, returns a signal</span>
(<span class="hljs-name"><span class="hljs-builtin-name">def</span></span> ratom3  (<span class="hljs-name">reaction</span> (<span class="hljs-name"><span class="hljs-builtin-name">condp</span></span> = (<span class="hljs-symbol">:b</span> @ratom2)  <span class="hljs-comment">;; reaction wraps another computation</span>
                             <span class="hljs-number">0</span> <span class="hljs-string">&quot;World&quot;</span>
                             <span class="hljs-number">1</span> <span class="hljs-string">&quot;Hello&quot;</span>)))

<span class="hljs-comment">;; Notice that both computations above involve de-referencing a ratom:</span>
<span class="hljs-comment">;;   - app-db in one case</span>
<span class="hljs-comment">;;   - ratom2 in the other</span>
<span class="hljs-comment">;; Notice that both reactions above return a ratom.</span>
<span class="hljs-comment">;; Those returned ratoms hold the (time varying) value of the computations.</span>

(<span class="hljs-name">println</span> @ratom2)    <span class="hljs-comment">;; ==&gt;  {:b 1}       ;; a computed result, involving @app-db</span>
(<span class="hljs-name">println</span> @ratom3)    <span class="hljs-comment">;; ==&gt; &quot;Hello&quot;       ;; a computed result, involving @ratom2</span>

(<span class="hljs-name"><span class="hljs-builtin-name">reset!</span></span>  app-db  {<span class="hljs-symbol">:a</span> <span class="hljs-number">0</span>})       <span class="hljs-comment">;; this change to app-db, triggers re-computation</span>
                               <span class="hljs-comment">;; of ratom2</span>
                               <span class="hljs-comment">;; which, in turn, causes a re-computation of ratom3</span>

(<span class="hljs-name">println</span> @ratom2)    <span class="hljs-comment">;; ==&gt;  {:b 0}    ;; ratom2 is result of {:b (:a @app-db)}</span>
(<span class="hljs-name">println</span> @ratom3)    <span class="hljs-comment">;; ==&gt; &quot;World&quot;    ;; ratom3 is automatically updated too.</span>
</code></pre>
<p>So, in FRP-ish terms, a <code>reaction</code> will produce a &quot;stream&quot; of values over time (it is a Signal),
accessible via the <code>ratom</code> it returns.</p>
<h2 id="components--view-functions">Components  (view functions)</h2>
<p>When using Reagent, your primary job is to write one or more <code>components</code>. 
This is the view layer.</p>
<p>Think about <code>components</code> as <code>pure functions</code> - data in, Hiccup out.  <code>Hiccup</code> is
ClojureScript data structures which represent DOM. Here&apos;s a trivial component:</p>
<pre><code class="lang-Clojure">(<span class="hljs-name"><span class="hljs-builtin-name">defn</span></span> greet
  []
  [<span class="hljs-symbol">:div</span> <span class="hljs-string">&quot;Hello ratoms and reactions&quot;</span>])
</code></pre>
<p>And if we call it:</p>
<pre><code class="lang-Clojure">(<span class="hljs-name">greet</span>)
<span class="hljs-comment">;; ==&gt;  [:div &quot;Hello ratoms and reactions&quot;]</span>
</code></pre>
<p>You&apos;ll notice that our component is a regular Clojure function, nothing special. In this case, it takes
no parameters and it returns a ClojureScript vector (formatted as Hiccup).</p>
<p>Here is a slightly more interesting (parameterised) component (function):</p>
<pre><code class="lang-Clojure">(<span class="hljs-name"><span class="hljs-builtin-name">defn</span></span> greet                    <span class="hljs-comment">;; greet has a parameter now</span>
  [name]                       <span class="hljs-comment">;; &apos;name&apos; is a ratom  holding a string</span>
  [<span class="hljs-symbol">:div</span> <span class="hljs-string">&quot;Hello &quot;</span>  @name])      <span class="hljs-comment">;; dereference &apos;name&apos; to extract the contained value</span>

<span class="hljs-comment">;; create a ratom, containing a string</span>
(<span class="hljs-name"><span class="hljs-builtin-name">def</span></span> n (<span class="hljs-name">reagent/atom</span> <span class="hljs-string">&quot;re-frame&quot;</span>))

<span class="hljs-comment">;; call our `component` function, passing in a ratom</span>
(<span class="hljs-name">greet</span> n)
<span class="hljs-comment">;; ==&gt;  [:div &quot;Hello &quot; &quot;re-frame&quot;]    returns a vector</span>
</code></pre>
<p>So components are easy - at core they are a render function which turns data into
Hiccup (which will later become DOM).</p>
<p>Now, let&apos;s introduce <code>reaction</code> into this mix.  On the one hand, I&apos;m complicating things
by doing this, because Reagent allows you to be ignorant of the mechanics I&apos;m about to show
you. (It invisibly wraps your components in a <code>reaction</code> allowing you to be blissfully
ignorant of how the magic happens.)</p>
<p>On the other hand, it is useful to understand exactly how the Reagent Signal graph is wired. </p>
<pre><code class="lang-Clojure">(<span class="hljs-name"><span class="hljs-builtin-name">defn</span></span> greet                <span class="hljs-comment">;; a component - data in, Hiccup out.</span>
  [name]                   <span class="hljs-comment">;; name is a ratom</span>
  [<span class="hljs-symbol">:div</span> <span class="hljs-string">&quot;Hello &quot;</span>  @name])  <span class="hljs-comment">;; dereference name here, to extract the value within</span>

(<span class="hljs-name"><span class="hljs-builtin-name">def</span></span> n (<span class="hljs-name">reagent/atom</span> <span class="hljs-string">&quot;re-frame&quot;</span>))

<span class="hljs-comment">;; The computation &apos;(greet n)&apos; returns Hiccup which is stored into &apos;hiccup-ratom&apos;</span>
(<span class="hljs-name"><span class="hljs-builtin-name">def</span></span> hiccup-ratom  (<span class="hljs-name">reaction</span> (<span class="hljs-name">greet</span> n)))    <span class="hljs-comment">;; &lt;-- use of reaction !!!</span>

<span class="hljs-comment">;; what is the result of the initial computation ?</span>
(<span class="hljs-name">println</span> @hiccup-ratom)
<span class="hljs-comment">;; ==&gt;  [:div &quot;Hello &quot; &quot;re-frame&quot;]    ;; returns hiccup  (a vector of stuff)</span>

<span class="hljs-comment">;; now change &apos;n&apos;</span>
<span class="hljs-comment">;; &apos;n&apos; is an input Signal for the reaction above.</span>
<span class="hljs-comment">;; Warning: &apos;n&apos; is not an input signal because it is a parameter. Rather, it is</span>
<span class="hljs-comment">;; because &apos;n&apos; is dereferenced within the execution of the reaction&apos;s computation.</span>
<span class="hljs-comment">;; reaction notices what ratoms are dereferenced in its computation, and watches</span>
<span class="hljs-comment">;; them for changes.</span>
(<span class="hljs-name"><span class="hljs-builtin-name">reset!</span></span> n <span class="hljs-string">&quot;blah&quot;</span>)            <span class="hljs-comment">;;    n changes</span>

<span class="hljs-comment">;; The reaction above will notice the change to &apos;n&apos; ...</span>
<span class="hljs-comment">;; ... and will re-run its computation ...</span>
<span class="hljs-comment">;; ... which will have a new &quot;return value&quot;...</span>
<span class="hljs-comment">;; ... which will be &quot;reset!&quot; into &quot;hiccup-ratom&quot;</span>
(<span class="hljs-name">println</span> @hiccup-ratom)
<span class="hljs-comment">;; ==&gt;   [:div &quot;Hello &quot; &quot;blah&quot;]    ;; yep, there&apos;s the new value</span>
</code></pre>
<p>So, as <code>n</code> changes value over time (via a <code>reset!</code>), the output of the computation <code>(greet n)</code>
changes, which in turn means that the value in <code>hiccup-ratom</code> changes. Both <code>n</code> and
<code>hiccup-ratom</code> are FRP Signals. The Signal graph we created causes data to flow from
<code>n</code> into <code>hiccup-ratom</code>.</p>
<p>Derived Data, flowing.</p>
<h3 id="truth-interlude">Truth Interlude</h3>
<p>I haven&apos;t been entirely straight with you:</p>
<ol>
<li><p>Reagent re-runs <code>reactions</code> (re-computations) via requestAnimationFrame. So a
re-computation happens about 16ms after an input Signals change is detected, or after the
current thread of processing finishes, whichever is the greater. So if you are in a bREPL
and you run the lines of code above one after the other too quickly,  you might not see the
re-computation done immediately after <code>n</code> gets reset!, because the next animationFrame
hasn&apos;t run (yet).  But you could add a <code>(reagent.core/flush)</code> after the reset! to force
re-computation to happen straight away.</p>
</li>
<li><p><code>reaction</code> doesn&apos;t actually return a <code>ratom</code>.  But it returns something that has
ratom-nature, so we&apos;ll happily continue believing it is a <code>ratom</code> and no harm will come to us.</p>
</li>
</ol>
<p>On with the rest of my lies and distortions...</p>
<h3 id="reg-sub-raw">reg-sub-raw</h3>
<p>This low level part of the API provides a way to register a subscription handler - so 
the intent is similar to <code>reg-sub</code>.</p>
<p>You use it like other registration functions: </p>
<pre><code class="lang-clj">(<span class="hljs-name">re-frame.core/reg-sub-raw</span>   <span class="hljs-comment">;; it is part of the API</span>
  <span class="hljs-symbol">:query-id</span>     <span class="hljs-comment">;; later use (subscribe [:query-id])</span>
  some-fn)      <span class="hljs-comment">;; this function provides the reactive stream</span>
</code></pre>
<p>The interesting bit is how <code>some-fn</code> is written. Here&apos;s an example:</p>
<pre><code class="lang-clj">(<span class="hljs-name"><span class="hljs-builtin-name">defn</span></span> some-fn 
  [app-db event]    <span class="hljs-comment">;; app-db is not a value, it is a reagent/atom</span>
  (<span class="hljs-name">reaction</span> (<span class="hljs-name"><span class="hljs-builtin-name">get-in</span></span> @app-db [<span class="hljs-symbol">:some</span> <span class="hljs-symbol">:path</span>])))  <span class="hljs-comment">;; returns a reaction</span>
</code></pre>
<p>Notice:</p>
<ol>
<li><code>app-db</code> is a reagent/atom. It is not a value like <code>reg-sub</code> gets.</li>
<li>it returns a <code>reaction</code> which does a computation. It does not return a value like <code>reg-sub</code> does.</li>
<li>Within that <code>reaction</code> <code>app-db</code> is deref-ed (see use of <code>@</code>) </li>
</ol>
<p>As a result of point 3, each time <code>app-db</code> changes, the wrapped <code>reaction</code> will rerun.
<code>app-db</code> is an input signal to that <code>reaction</code>. </p>
<p>Unlike <code>reg-sub</code>, there is no 3-arity version of <code>reg-sub-raw</code>, so there&apos;s no way for you to provide an input signals function.
Instead, even simpler, you can just use <code>subscribe</code> within the <code>reaction</code> itself. For example:</p>
<pre><code class="lang-clj">(<span class="hljs-name"><span class="hljs-builtin-name">defn</span></span> some-fn
   [app-db event]
   (<span class="hljs-name">reaction</span>
     (<span class="hljs-name"><span class="hljs-builtin-name">let</span></span> [a-path-element @(<span class="hljs-name">subscribe</span> [<span class="hljs-symbol">:get-path-part</span>])]   <span class="hljs-comment">;; &lt;-- subscribe used here</span>
       (<span class="hljs-name"><span class="hljs-builtin-name">get-in</span></span> @app-db [<span class="hljs-symbol">:some</span> a-path-element]))))
</code></pre>
<p>As you can see, this <code>reaction</code> has two input signals: <code>app-db</code> and <code>(subscribe [:get-path-part])</code>.  If either changes, 
the <code>reaction</code> will rerun.</p>
<p>In some cases, the returned <code>reaction</code> might not even
use <code>app-db</code> and, instead, it might only use <code>subscribe</code> to provide input signals. In that case, the 
registered subscription would belong to &quot;Level 3&quot; of the signal graph (discussed in earlier tutorials).</p>
<p>Remember to deref any use of <code>app-db</code> and <code>subscribe</code>.  It is a rookie mistake to forget. I do it regularly.</p>
<p>Instead of using <code>reaction</code> (a macro), you can use <code>reagent/make-reaction</code> (a utility function) which gives you the additional 
ability to attach an <code>:on-dispose</code> handler to the returned reaction, allowing you to do cleanup work when the subscription is no longer needed. 
<a href="Subscribing-To-External-Data.html">See an example of using <code>:on-dispose</code> here</a></p>
<h3 id="example-reg-sub-raw">Example reg-sub-raw</h3>
<p>The following use of <code>reg-sub</code> can be found in <a href="https://github.com/Day8/re-frame/blob/master/examples/todomvc/src/todomvc/subs.cljs" target="_blank">the todomvc example</a>:</p>
<pre><code class="lang-clj">(<span class="hljs-name">reg-sub</span>
  <span class="hljs-symbol">:visible-todos</span>

  <span class="hljs-comment">;; signal function - returns a vector of two input signals</span>
  (<span class="hljs-name"><span class="hljs-builtin-name">fn</span></span> [query-v _]     
    [(<span class="hljs-name">subscribe</span> [<span class="hljs-symbol">:todos</span>])
     (<span class="hljs-name">subscribe</span> [<span class="hljs-symbol">:showing</span>])])

  <span class="hljs-comment">;; the computation function - 1st arg is a 2-vector of values</span>
  (<span class="hljs-name"><span class="hljs-builtin-name">fn</span></span> [[todos showing] _]   
    (<span class="hljs-name"><span class="hljs-builtin-name">let</span></span> [filter-fn (<span class="hljs-name"><span class="hljs-builtin-name">case</span></span> showing
                      <span class="hljs-symbol">:active</span> (<span class="hljs-name"><span class="hljs-builtin-name">complement</span></span> <span class="hljs-symbol">:done</span>)
                      <span class="hljs-symbol">:done</span>   <span class="hljs-symbol">:done</span>
                      <span class="hljs-symbol">:all</span>    identity)]
      (<span class="hljs-name"><span class="hljs-builtin-name">filter</span></span> filter-fn todos))))
</code></pre>
<p>we could rewrite this use of <code>reg-sub</code> using <code>reg-sub-raw</code> like this:</p>
<pre><code class="lang-clj">(<span class="hljs-name">reg-sub-raw</span> 
  <span class="hljs-symbol">:visible-todos</span>
  (<span class="hljs-name"><span class="hljs-builtin-name">fn</span></span> [app-db event]  <span class="hljs-comment">;; app-db not used, name shown for clarity</span>
    (<span class="hljs-name">reaction</span>         <span class="hljs-comment">;; wrap the computation in a reaction</span>
      (<span class="hljs-name"><span class="hljs-builtin-name">let</span></span> [todos   @(<span class="hljs-name">subscribe</span> [<span class="hljs-symbol">:todos</span>])   <span class="hljs-comment">;; input signal #1</span>
            showing @(<span class="hljs-name">subscribe</span> [<span class="hljs-symbol">:showing</span>]) <span class="hljs-comment">;; input signal #2 </span>
            filter-fn (<span class="hljs-name"><span class="hljs-builtin-name">case</span></span> showing
                        <span class="hljs-symbol">:active</span> (<span class="hljs-name"><span class="hljs-builtin-name">complement</span></span> <span class="hljs-symbol">:done</span>)
                        <span class="hljs-symbol">:done</span>   <span class="hljs-symbol">:done</span>
                        <span class="hljs-symbol">:all</span>    identity)]
        (<span class="hljs-name"><span class="hljs-builtin-name">filter</span></span> filter-fn todos))))
</code></pre>
<p>A view could do <code>(subscribe [:visible-todos])</code> and never know which of 
the two variations above was used. Same result delivered.</p>
<hr>
<p>Previous: <a href="SubscriptionsCleanup.html">Correcting a wrong</a>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;
Up:       <a href="./">Index</a>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;
Next:     <a href="Basic-App-Structure.html">Basic App Structure</a> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</p>
<!-- START doctoc generated TOC please keep comment here to allow auto update -->
<!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE -->
<!-- END doctoc generated TOC please keep comment here to allow auto update -->

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="SubscriptionsCleanup.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page: Correcting a wrong">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Flow Mechanics","level":"5.3","depth":1,"next":{"title":"The Basics","level":"6.1","depth":1,"anchor":"#reagent-tutorials","url":"https://github.com/Day8/re-frame/wiki#reagent-tutorials","ref":"https://github.com/Day8/re-frame/wiki#reagent-tutorials","articles":[]},"previous":{"title":"Correcting a wrong","level":"5.2","depth":1,"path":"SubscriptionsCleanup.md","ref":"SubscriptionsCleanup.md","articles":[]},"dir":"ltr"},"config":{"plugins":[],"root":"./docs/","styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"README.md"},"variables":{},"title":"re-frame","language":"en","gitbook":"*","description":"Documentation of re-frame framework"},"file":{"path":"SubscriptionFlow.md","mtime":"2017-09-21T10:24:52.725Z","type":"markdown"},"gitbook":{"version":"3.2.2","time":"2017-09-21T10:34:13.106Z"},"basePath":".","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="gitbook/gitbook.js"></script>
    <script src="gitbook/theme.js"></script>
    
        
        <script src="gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

