
<!DOCTYPE HTML>
<html lang="en" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>This Repo's README Â· re-frame</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.2">
        
        
        
    
    <link rel="stylesheet" href="re-frame/gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="re-frame/gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="re-frame/gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="re-frame/gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="re-frame/gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="re-frame/gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="re-frame/ApplicationState.html" />
    
    
    <link rel="prev" href="re-frame/" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        <li class="header">description: re-frame official documentation</li>
        
        
    
        <li class="chapter " data-level="1.1" data-path="re-frame/">
            
                <a href="re-frame/">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Derived Values, Flowing</li>
        
        
    
        <li class="chapter active" data-level="2.1" data-path="./">
            
                <a href="./">
            
                    
                    This Repo's README
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="re-frame/ApplicationState.html">
            
                <a href="re-frame/ApplicationState.html">
            
                    
                    app-db (Application State)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3" data-path="re-frame/CodeWalkthrough.html">
            
                <a href="re-frame/CodeWalkthrough.html">
            
                    
                    First Code Walk-Through
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.4" data-path="re-frame/API.html">
            
                <a href="re-frame/API.html">
            
                    
                    The API
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.5" data-path="re-frame/MentalModelOmnibus.html">
            
                <a href="re-frame/MentalModelOmnibus.html">
            
                    
                    Mental Model Omnibus
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Alternative Introductions</li>
        
        
    
        <li class="chapter " data-level="3.1" >
            
                <a target="_blank" href="https://purelyfunctional.tv/guide/re-frame-building-blocks/">
            
                    
                    purelyfunctional.tv
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2" >
            
                <a target="_blank" href="https://lambdaisland.com/episodes">
            
                    
                    Lambda Island Videos
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Dominoes 2 and 3 - Event Handlers</li>
        
        
    
        <li class="chapter " data-level="4.1" data-path="re-frame/EventHandlingInfographic.html">
            
                <a href="re-frame/EventHandlingInfographic.html">
            
                    
                    Infographic Overview
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.2" data-path="re-frame/EffectfulHandlers.html">
            
                <a href="re-frame/EffectfulHandlers.html">
            
                    
                    Effectful Handlers
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.3" data-path="re-frame/Interceptors.html">
            
                <a href="re-frame/Interceptors.html">
            
                    
                    Interceptors
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.4" data-path="re-frame/Effects.html">
            
                <a href="re-frame/Effects.html">
            
                    
                    Effects
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.5" data-path="re-frame/Coeffects.html">
            
                <a href="re-frame/Coeffects.html">
            
                    
                    Coeffects
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Domino 4 - Subscriptions</li>
        
        
    
        <li class="chapter " data-level="5.1" data-path="re-frame/SubscriptionInfographic.html">
            
                <a href="re-frame/SubscriptionInfographic.html">
            
                    
                    Infographic
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.2" data-path="re-frame/SubscriptionsCleanup.html">
            
                <a href="re-frame/SubscriptionsCleanup.html">
            
                    
                    Correcting a wrong
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.3" data-path="re-frame/SubscriptionFlow.html">
            
                <a href="re-frame/SubscriptionFlow.html">
            
                    
                    Flow Mechanics
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Domino 5 - Reagent Tutorials</li>
        
        
    
        <li class="chapter " data-level="6.1" >
            
                <a target="_blank" href="https://github.com/Day8/re-frame/wiki#reagent-tutorials">
            
                    
                    The Basics
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.2" >
            
                <a target="_blank" href="https://lambdaisland.com/episodes">
            
                    
                    Lambda Island Videos
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.3" >
            
                <a target="_blank" href="https://purelyfunctional.tv/guide/reagent/">
            
                    
                    purelyfunctional.tv 
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.4" >
            
                <a target="_blank" href="http://timothypratley.blogspot.com.au/p/p.html">
            
                    
                    Reagent Deep Dive Series from Timothy Pratley
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.5" >
            
                <a target="_blank" href="https://www.martinklepsch.org/posts/props-children-and-component-lifecycle-in-reagent.html">
            
                    
                    Props, Children & Component Lifecycle
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">App Structure</li>
        
        
    
        <li class="chapter " data-level="7.1" data-path="re-frame/Basic-App-Structure.html">
            
                <a href="re-frame/Basic-App-Structure.html">
            
                    
                    Basic App Structure
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="7.2" data-path="re-frame/Navigation.html">
            
                <a href="re-frame/Navigation.html">
            
                    
                    Navigation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="7.3" data-path="re-frame/Namespaced-Keywords.html">
            
                <a href="re-frame/Namespaced-Keywords.html">
            
                    
                    Namespaced Keywords
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">App Data</li>
        
        
    
        <li class="chapter " data-level="8.1" data-path="re-frame/Loading-Initial-Data.html">
            
                <a href="re-frame/Loading-Initial-Data.html">
            
                    
                    Loading Initial Data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="8.2" data-path="re-frame/Talking-To-Servers.html">
            
                <a href="re-frame/Talking-To-Servers.html">
            
                    
                    Talking To Servers
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="8.3" data-path="re-frame/Subscribing-To-External-Data.html">
            
                <a href="re-frame/Subscribing-To-External-Data.html">
            
                    
                    Subscribing to External Data
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Debugging And Testing</li>
        
        
    
        <li class="chapter " data-level="9.1" data-path="re-frame/Debugging-Event-Handlers.html">
            
                <a href="re-frame/Debugging-Event-Handlers.html">
            
                    
                    Debugging Event Handlers
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="9.2" data-path="re-frame/Debugging.html">
            
                <a href="re-frame/Debugging.html">
            
                    
                    Debugging
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="9.3" data-path="re-frame/Testing.html">
            
                <a href="re-frame/Testing.html">
            
                    
                    Testing
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Miscellaneous</li>
        
        
    
        <li class="chapter " data-level="10.1" data-path="re-frame/FAQs/">
            
                <a href="re-frame/FAQs/">
            
                    
                    FAQs
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="10.2" data-path="re-frame/External-Resources.html">
            
                <a href="re-frame/External-Resources.html">
            
                    
                    External Resources
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="10.3" data-path="re-frame/Performance-Problems.html">
            
                <a href="re-frame/Performance-Problems.html">
            
                    
                    Eek! Performance Problems
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="10.4" data-path="re-frame/Solve-the-CPU-hog-problem.html">
            
                <a href="re-frame/Solve-the-CPU-hog-problem.html">
            
                    
                    Solve the CPU hog problem
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="10.5" data-path="re-frame/Using-Stateful-JS-Components.html">
            
                <a href="re-frame/Using-Stateful-JS-Components.html">
            
                    
                    Using Stateful JS Components
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="10.6" data-path="re-frame/The-re-frame-logo.html">
            
                <a href="re-frame/The-re-frame-logo.html">
            
                    
                    The re-frame Logo
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="10.7" data-path="re-frame/Code-Of-Conduct.html">
            
                <a href="re-frame/Code-Of-Conduct.html">
            
                    
                    Code Of Conduct
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="re-frame" >This Repo's README</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <p><img src="re-frame/images/logo/re-frame_128w.png?raw=true"></p>
<h2 id="derived-values-flowing">Derived Values, Flowing</h2>
<blockquote>
<p>This, milord, is my family&apos;s axe. We have owned it for almost nine hundred years, see. Of course,
sometimes it needed a new blade. And sometimes it has required a new handle, new designs on the
metalwork, a little refreshing of the ornamentation ... but is this not the nine hundred-year-old
axe of my family? And because it has changed gently over time, it is still a pretty good axe,
y&apos;know. Pretty good.</p>
<p>-- Terry Pratchett, The Fifth Elephant <br>
&#xA0;&#xA0;&#xA0; reflecting on identity, flow and derived values</p>
</blockquote>
<p><a href="https://clojars.org/re-frame" target="_blank"><img src="https://img.shields.io/clojars/v/re-frame.svg" alt="Clojars Project"></a>
<a href="license.txt"><img src="https://img.shields.io/github/license/Day8/re-frame.svg" alt="GitHub license"></a>
<a href="https://circleci.com/gh/Day8/re-frame/tree/master" target="_blank"><img src="https://circleci.com/gh/Day8/re-frame/tree/master.svg?style=shield&amp;circle-token=:circle-ci-badge-token" alt="Circle CI"></a></p>
<h2 id="re-frame">re-frame</h2>
<p>re-frame is a pattern for writing <a href="http://en.wikipedia.org/wiki/Single-page_application" target="_blank">SPAs</a> in ClojureScript, using <a href="http://reagent-project.github.io/" target="_blank">Reagent</a>.</p>
<p>McCoy might report &quot;It&apos;s MVC, Jim, but not as we know it&quot;.  And you would respond 
&quot;McCoy, you trouble maker, why even mention an OO pattern? 
re-frame is a <strong>functional framework</strong>.&quot;</p>
<p>Being a functional framework, it is about data, and the functions 
which transform that data.</p>
<h2 id="why-should-you-care">Why Should You Care?</h2>
<p>Perhaps:</p>
<ol>
<li>You want to develop an <a href="http://en.wikipedia.org/wiki/Single-page_application" target="_blank">SPA</a> in ClojureScript, and you are looking for a framework.</li>
<li>You believe Facebook did something magnificent when it created React, and
you are curious about the further implications. Is the combination of
<code>reactive programming</code>, <code>functional programming</code> and <code>immutable data</code> going to
<strong>completely change everything</strong>?  And, if so, what would that look like in a language
that embraces those paradigms?</li>
<li>You&apos;re taking a <a href="http://www.eli.sdsu.edu/courses/fall15/cs696/index.html" target="_blank">Functional Design and Programming course</a> at San Diego State University
and you have a re-frame/reagent assignment due.  You&apos;ve left the reading a bit late, right?</li>
<li>You know Redux, Elm, Cycle.js or Pux and you&apos;re
interested in a ClojureScript implementation.
In this space, re-frame is very old, hopefully in a Gandalf kind of way.
First designed in Dec 2014, it even slightly pre-dates the official Elm Architecture,
although thankfully we were influenced by early-Elm concepts like <code>foldp</code> and <code>lift</code>, as well as 
Clojure projects like <a href="https://github.com/pedestal/pedestal-app" target="_blank">Pedestal App</a>, <a href="https://github.com/swannodette/om" target="_blank">Om</a> and <a href="http://hoplon.io/" target="_blank">Hoplon</a>. Since then,
re-frame has pioneered ideas like event handler middleware,
coeffect accretion, and de-duplicated signal graphs.</li>
<li>Which brings us to the most important point: <strong>re-frame is impressively buzzword compliant</strong>. It has reactivity,
unidirectional data flow, pristinely pure functions,
interceptors, coeffects, conveyor belts, statechart-friendliness (FSM)
and claims an immaculate hammock conception. It also has a charming
xkcd reference (soon) and a hilarious, insiders-joke T-shirt,
ideal for conferences (in design).  What could possibly go wrong?</li>
</ol>
<h2 id="it-leverages-data">It Leverages Data</h2>
<p>You might already know that ClojureScript is a modern lisp, and that
lisps are <strong>homoiconic</strong>.  If not, you do now.</p>
<p>That homoiconic bit is significant. It means you program in a lisp by creating and
assembling lisp data structures. Dwell on that for a moment. You are <strong>programming in data</strong>. 
The functions which later transform data, themselves start as data.</p>
<p>Clojure programmers place particular 
emphasis on the primacy of data. When they aren&apos;t re-watching Rich Hickey videos, 
and wishing their hair was darker and more curly, 
they meditate on aphorisms like <strong>Data is the ultimate in late binding</strong>.</p>
<p>I cannot stress enough what a big deal this is. It may seem 
like a syntax curiosity at first but, when the penny drops for 
you on this, it tends to be a profound moment. And once you 
understand the importance of this concept at the language level, 
you naturally want to leverage similar power at the library level.</p>
<p>So, it will come as no surprise, then, to know that re-frame has a 
data oriented design. Events are data. Effects are data. DOM is data.
The functions which transform data are registered and looked up via 
data. Interceptors (data) are preferred over middleware (higher 
order functions). Etc.</p>
<p><strong>Data - that&apos;s the way we roll.</strong></p>
<h2 id="it-is-a-loop">It is a loop</h2>
<p>Architecturally, re-frame implements &quot;a perpetual loop&quot;.</p>
<p>To build an app, you hang pure functions on certain parts of this loop, 
and re-frame looks after the <code>conveyance of data</code> 
around the loop, into and out of the transforming functions you 
provide - hence a tag line of &quot;Derived Values, Flowing&quot;.</p>
<h3 id="it-does-physics">It does Physics</h3>
<p>Remember this diagram from school? The water cycle, right?</p>
<p><img height="350px" align="right" src="re-frame/images/the-water-cycle.png?raw=true"></p>
<p>Two distinct stages, involving water in different phases, being acted upon
by different forces: gravity working one way, evaporation/convection the other.</p>
<p>To understand re-frame, <strong>imagine data flowing around that loop instead of water</strong>.</p>
<p>re-frame
provides the conveyance of the data around the loop - the equivalent of gravity, evaporation and convection.
You design what&apos;s flowing and then you hang functions off the loop at
various points to compute the data&apos;s phase changes.</p>
<p>Sure, right now, you&apos;re thinking &quot;lazy sod - make a proper Computer Science-y diagram&quot;. But, no.
Joe Armstrong says &quot;don&apos;t break the laws of physics&quot; - I&apos;m sure
you&apos;ve seen the videos - and if he says to do something, you do it
(unless Rich Hickey disagrees, and says to do something else). So,
this diagram, apart from being a plausible analogy which might help
you to understand re-frame, is <strong>practically proof</strong> it does physics.</p>
<h2 id="it-is-a-6-domino-cascade">It is a 6-domino cascade</h2>
<p><img align="right" src="re-frame/images/Readme/Dominoes-small.jpg?raw=true"></p>
<p>Computationally, each iteration of the loop involves a
six domino cascade.</p>
<p>One domino triggers the next, which triggers the next, et cetera, boom, boom, boom, until we are 
back at the beginning of the loop, and the dominoes spring to attention 
again, ready for the next iteration of the same cascade.</p>
<p>The six dominoes are: </p>
<ol>
<li>Event dispatch</li>
<li>Event handling </li>
<li>Effect handling </li>
<li>Query</li>
<li>View</li>
<li>DOM</li>
</ol>
<h3 id="1st-domino---event-dispatch">1st Domino - Event Dispatch</h3>
<p>An <code>event</code> is sent when something happens - the user 
clicks a button, or a websocket receives a new message.</p>
<p>Without the impulse of a triggering <code>event</code>, no six domino cascade occurs.
It is only because of <code>event</code>s that a re-frame app is propelled,
loop iteration after loop iteration, from one state to the next.</p>
<p>re-frame is <code>event</code> driven.</p>
<h3 id="2nd-domino---event-handling">2nd Domino - Event Handling</h3>
<p>In response to an <code>event</code>, an application must decide what action to take. 
This is known as <code>event handling</code>.</p>
<p>Event handler functions compute side effects (known in re-frame simply as <code>effects</code>). 
More accurately, they compute 
a <strong>description of <code>effects</code></strong>. This description is a data structure 
which says, declaratively, how the world should change (because of the event).</p>
<p>Much of the time, only the &quot;application state&quot; of the SPA itself need
change, but sometimes the outside world must also be affected
(localstore, cookies, databases, emails, logs, etc).</p>
<h3 id="3rd-domino---effect-handling">3rd Domino - Effect Handling</h3>
<p>The descriptions of <code>effects</code> are realised (actioned).</p>
<p>Now, to a functional programmer, <code>effects</code> are scary in a 
<a href="https://www.google.com.au/search?q=xenomorph" target="_blank">xenomorph kind of way</a>.
Nothing messes with functional purity
quite like the need for side effects. On the other hand, <code>effects</code> are 
marvelous because they move the app forward. Without them, 
an app stays stuck in one state forever, never achieving anything.</p>
<p>So re-frame embraces the protagonist nature of <code>effects</code> - the entire, unruly zoo of them - but
it does so in a controlled and largely hidden way, and in a manner which is debuggable, auditable, mockable and pluggable.</p>
<h3 id="were-now-at-a-pivot-point">We&apos;re Now At A Pivot Point</h3>
<p>Domino 3 just changed the world and, very often, one particular part of it: the <strong>application state</strong>.</p>
<p>re-frame&apos;s <code>app state</code> is held in one place - think of it like you 
would an in-memory, central database for the app (details later).</p>
<p>Any changes to <code>app state</code> trigger the next part of the cascade 
involving dominoes 4-5-6.</p>
<h3 id="theres-a-formula-for-it">There&apos;s a Formula For It</h3>
<p>The 4-5-6 domino cascade implements the formula made famous by Facebook&apos;s ground-breaking React library:<br>  <code>v = f(s)</code></p>
<p>A view, <code>v</code>, is a function, <code>f</code>, of the app state, <code>s</code>.</p>
<p>Said another way, there are functions <code>f</code> that compute which DOM nodes, <code>v</code>,
should be displayed to the user when the application is in a given app state, <code>s</code>.</p>
<p>Or, to capture the dynamics we&apos;d say: <strong>over time</strong>, as <code>s</code> changes, <code>f</code>
will be re-run each time to compute new <code>v</code>, forever keeping <code>v</code> up to date with the current <code>s</code>.</p>
<p>Or, with yet another emphasis: <strong>over time</strong> what is presented to the user changes in response to application state changes. </p>
<p>In our case, domino 3 changes <code>s</code>, the application state,
and, in response, dominoes 4-5-6 are concerned with re-running <code>f</code> to compute the new <code>v</code> 
shown to the user.</p>
<p>Except, of course, there are nuances.  For instance, there&apos;s no single <code>f</code> to run.
There may be many functions which collectively build the overall DOM, 
and only part of <code>s</code> may change at any one time, so only part of the 
<code>v</code> (DOM) need be re-computed and updated. And some parts of <code>v</code> might not 
be showing right now.</p>
<h3 id="domino-4---query">Domino 4 - Query</h3>
<p><img align="right" src="re-frame/images/Readme/6dominoes.png?raw=true"></p>
<p>Domino 4 is about extracting data from &quot;app state&quot;, and providing it 
in the right format for view functions (which are Domino 5).</p>
<p>Domino 4 is a novel and efficient de-duplicated signal graph which 
runs query functions on the app state, <code>s</code>, efficiently computing 
reactive, multi-layered, &quot;materialised views&quot; of <code>s</code>.</p>
<p>(Relax about any unfamiliar terminology, you&apos;ll soon 
see how simple the code actually is)</p>
<h3 id="domino-5---view">Domino 5 - View</h3>
<p>Domino 5 is one or more <strong>view functions</strong> (aka Reagent components) that compute the 
UI DOM that should be displayed to the user.</p>
<p>To render the right UI, they need to source application state, which is
delivered reactively via the queries of Domino 4. They 
compute hiccup-formatted data, which is a description of the DOM required.</p>
<h3 id="domino-6---dom">Domino 6 - DOM</h3>
<p>You don&apos;t write Domino 6 - it is handled for you 
by Reagent/React. I mention it here 
for completeness and to fully close the loop.</p>
<p>This is the step in which the hiccup-formatted 
&quot;descriptions of required DOM&quot;, returned by the view functions of Domino 5, are made real.
The browser DOM nodes are mutated. </p>
<h2 id="managing-mutation">Managing mutation</h2>
<p>The two sub-cascades 1-2-3 and 4-5-6 have a similar structure.</p>
<p>In each, it is the second to last domino which 
computes &quot;data descriptions&quot; of mutations required, and it is 
the last domino which does the dirty work and realises these descriptions.</p>
<p>In both cases, you don&apos;t need to worry yourself about this dirty work. re-frame looks 
after those dominoes.</p>
<h3 id="a-cascade-of-simple-functions">A Cascade Of Simple Functions</h3>
<p><strong>You&apos;ll (mostly) be writing pure functions</strong> which 
can be described, understood and 
tested independently. They take data, transform it and return new data.</p>
<p>The loop itself is mechanical and predictable in operation.
So, there&apos;s a regularity to how a re-frame app goes about its business,
which leads, in turn, to an ease in reasoning and debugging.</p>
<h2 id="the-dominoes-again---with-code-fragments">The Dominoes Again - With Code Fragments</h2>
<p><img align="right" src="re-frame/images/Readme/todolist.png?raw=true"></p>
<p>So that was the view of re-frame from 60,000 feet. We&apos;ll now shift down to 30,000 feet 
and look again at each domino, but this time with code fragments.</p>
<p><strong>Imagine:</strong> we&apos;re working on a SPA which displays a list of items. You have 
just clicked the &quot;delete&quot; button next to the 3rd item in the list.</p>
<p>In response, what happens within this imaginary re-frame app? Here&apos;s a sketch 
of the six domino cascade:</p>
<blockquote>
<p>Don&apos;t expect 
to completely grok the terse code presented below. We&apos;re still at 30,000 feet. Details later. </p>
</blockquote>
<h3 id="code-for-domino-1">Code For Domino 1</h3>
<p>The delete button for that 3rd item will be rendered by a ViewFunction which looks like this: </p>
<pre><code class="lang-clj">(<span class="hljs-name"><span class="hljs-builtin-name">defn</span></span> delete-button 
  [item-id]
  [<span class="hljs-symbol">:div.garbage-bin</span> 
     <span class="hljs-symbol">:on-click</span> #(<span class="hljs-name">re-frame.core/dispatch</span> [<span class="hljs-symbol">:delete-item</span> item-id])])
</code></pre>
<p>That <code>on-click</code> handler uses re-frame&apos;s <code>dispatch</code> to emit an <code>event</code>.</p>
<p>A re-frame <code>event</code> is a vector and, in this case, 
it has 2 elements: <code>[:delete-item 2486]</code> (where <code>2486</code> is the made-up id for that 3rd item).  </p>
<p>The first element of an event vector,
<code>:delete-item</code>, is the kind of event. The rest is optional, useful data about the 
<code>event</code>.  </p>
<p>Events express intent in a domain specific way. 
They are the language of your re-frame system. </p>
<h3 id="code-for-domino-2">Code For Domino 2</h3>
<p>An <code>event handler</code> (function), called say <code>h</code>, is called to 
compute the <code>effect</code> of the event <code>[:delete-item 2486]</code>.</p>
<p>On app startup, <code>re-frame.core/reg-event-fx</code> would have been used to 
register this <code>h</code> as the handler for  <code>:delete-item</code> events, like this:</p>
<pre><code class="lang-clj">(<span class="hljs-name">re-frame.core/reg-event-fx</span>   <span class="hljs-comment">;; a part of the re-frame API</span>
  <span class="hljs-symbol">:delete-item</span>                <span class="hljs-comment">;; the kind of event</span>
  h)                         <span class="hljs-comment">;; the handler function for this kind of event</span>
</code></pre>
<p><code>h</code> is written to take two arguments: </p>
<ol>
<li>a <code>coeffects</code> map which contains the current state of the world (including app state)</li>
<li>the <code>event</code> to handle</li>
</ol>
<p>It is the job of <code>h</code> to compute how the world should be changed by the event, and 
it returns a map of <code>effects</code> - a description of those changes.</p>
<p>Here&apos;s a sketch (we are at 30,000 feet):</p>
<pre><code class="lang-clj">(<span class="hljs-name"><span class="hljs-builtin-name">defn</span></span> h                               <span class="hljs-comment">;; choose a better name like delete-item</span>
 [coeffects event]                    <span class="hljs-comment">;; args:  db from coeffect, event</span>
 (<span class="hljs-name"><span class="hljs-builtin-name">let</span></span> [item-id (<span class="hljs-name"><span class="hljs-builtin-name">second</span></span> event)         <span class="hljs-comment">;; extract id from event vector</span>
       db      (<span class="hljs-symbol">:db</span> coeffects)]       <span class="hljs-comment">;; extract the current application state</span>
   {<span class="hljs-symbol">:db</span>  (<span class="hljs-name">dissoc-in</span> db [<span class="hljs-symbol">:items</span> item-id])})) <span class="hljs-comment">;; effect is change app state</span>
</code></pre>
<p>re-frame has ways (described in later tutorials) to inject necessary aspects
of the world into that first <code>coeffects</code> argument (map). Different 
event handlers need different &quot;things&quot; to get their job done. But 
current &quot;application state&quot; is one aspect of the world which is 
invariably needed, and it is available by default in the <code>:db</code> key.</p>
<p>BTW, here is a more idiomatic rewrite of <code>h</code> which uses &quot;destructuring&quot; of the args: </p>
<pre><code class="lang-clj">(<span class="hljs-name"><span class="hljs-builtin-name">defn</span></span> h 
 [{<span class="hljs-symbol">:keys</span> [db]} [_ item-id]]    <span class="hljs-comment">;; &lt;--- new: obtain db and id directly</span>
 {<span class="hljs-symbol">:db</span>  (<span class="hljs-name">dissoc-in</span> db [<span class="hljs-symbol">:items</span> item-id])}) <span class="hljs-comment">;; same as before</span>
</code></pre>
<h3 id="code-for-domino-3">Code For Domino 3</h3>
<p>An <code>effect handler</code> (function) actions the <code>effects</code> returned by <code>h</code>.</p>
<p>Here&apos;s what <code>h</code> returned:</p>
<pre><code class="lang-clj">{<span class="hljs-symbol">:db</span>  (<span class="hljs-name">dissoc-in</span> db [<span class="hljs-symbol">:items</span> <span class="hljs-number">2486</span>])}   <span class="hljs-comment">;; db is a map of some structure</span>
</code></pre>
<p>Each key of the map identifies one kind 
of <code>effect</code>, and the value for that key supplies further details. 
The map returned by <code>h</code> only has one key, so there&apos;s only one effect.</p>
<p>A key of <code>:db</code> means to update the app state with the key&apos;s value.</p>
<p>This update of &quot;app state&quot; is a mutative step, facilitated by re-frame
which has a built-in <code>effects handler</code> for the <code>:db</code> effect.</p>
<p>Why the name <code>:db</code>?  Well, re-frame sees &quot;app state&quot; as something of an in-memory 
database. More on this in a following tutorial.</p>
<p>Just to be clear, if <code>h</code> had returned: </p>
<pre><code class="lang-clj">{<span class="hljs-symbol">:wear</span>  {<span class="hljs-symbol">:pants</span> <span class="hljs-string">&quot;velour flares&quot;</span>  <span class="hljs-symbol">:belt</span> <span class="hljs-literal">false</span>}
 <span class="hljs-symbol">:tweet</span> <span class="hljs-string">&quot;Okay, yes, I am Satoshi. #coverblown&quot;</span>}
</code></pre>
<p>Then, the two effects handlers registered for <code>:wear</code> and <code>:tweet</code> would 
be called to action those two effects. And, no, re-frame 
does not supply standard effect handlers for either, so you would have had 
to have written them yourself (see how in a later tutorial).</p>
<h3 id="code-for-domino-4">Code For Domino 4</h3>
<p>We now start the <code>v = f(s)</code> part of the flow. </p>
<p>The application state
<code>s</code> has just changed (via Domino 3) and now boom, boom go Dominoes 4, 5, 
and 6, at the end of which we have a new view, <code>v</code>, being shown to the user.</p>
<p>In this domino 4, a query (function) over this app state is automatically 
called.  This query function &quot;extracts&quot; data from application state, and 
then computes &quot;a materialised view&quot; of the application state - producing
data which is useful to the view functions of domino, 5.</p>
<p>Now, in this particular case, the query function is pretty trivial.
Because the items are stored in app state, there&apos;s not a lot 
to compute and, instead, it acts strictly like an extractor or accessor,
just plucking the list of items out of application state:</p>
<pre><code class="lang-clj">(<span class="hljs-name"><span class="hljs-builtin-name">defn</span></span> query-fn
  [db v]         <span class="hljs-comment">;; db is current app state, v the query vector</span>
  (<span class="hljs-symbol">:items</span> db))   <span class="hljs-comment">;; not much of a materialised view</span>
</code></pre>
<p>On program startup, such a <code>query-fn</code> must be associated with a <code>query-id</code>, 
(so it can be used via <code>subscribe</code> in domino 5) using <code>re-frame.core/reg-sub</code>, 
like this:</p>
<pre><code class="lang-clj">(<span class="hljs-name">re-frame.core/reg-sub</span>  <span class="hljs-comment">;; part of the re-frame API</span>
   <span class="hljs-symbol">:query-items</span>         <span class="hljs-comment">;; query id  </span>
   query-fn)            <span class="hljs-comment">;; query fn</span>
</code></pre>
<p>Which says &quot;if, in domino 5, you see a <code>(subscribe [:query-items])</code>, then 
use <code>query-fn</code> to compute it&quot;.</p>
<h3 id="code-for-domino-5">Code For Domino 5</h3>
<p>Because the query function for <code>:query-items</code> just re-computed a new value, 
any view (function) which uses a <code>(subscribe [:query-items])</code> 
is called automatically (reactively) to re-compute new DOM.</p>
<p>View functions compute a data structure, in hiccup format, describing 
the DOM nodes required. In this &quot;items&quot; case, the view functions will <em>not</em> be generating 
hiccup for the just-deleted item obviously but, other than this, 
the hiccup computed &quot;this time&quot; will be the same as &quot;last time&quot;.</p>
<pre><code class="lang-clj">(<span class="hljs-name"><span class="hljs-builtin-name">defn</span></span> items-view
  []
  (<span class="hljs-name"><span class="hljs-builtin-name">let</span></span> [items  (<span class="hljs-name">subscribe</span> [<span class="hljs-symbol">:query-items</span>])]  <span class="hljs-comment">;; source items from app state</span>
    [<span class="hljs-symbol">:div</span> (<span class="hljs-name"><span class="hljs-builtin-name">map</span></span> item-render @items)]))   <span class="hljs-comment">;; assume item-render already written</span>
</code></pre>
<p>Notice how <code>items</code> is &quot;sourced&quot; from &quot;app state&quot; via <code>re-frame.core/subscribe</code>.
It is called with a vector argument, and the first element of that vector is
a query-id which identifies the &quot;materialised view&quot; required by the view.</p>
<p>Note: <code>subscribe</code> queries can be parameterised. So, in real world apps
you might have this:<br>
  <code>(subscribe [:items &quot;blue&quot;])</code></p>
<p>The vector identifies, first, the query, and then
supplies further arguments. You could think of that as 
representing <code>select * from Items where colour=&quot;blue&quot;</code>.</p>
<p>Except there&apos;s no SQL available and you would be the one to implement
the more sophisticated <code>query-fn</code> capable of handling the 
&quot;where&quot; argument. More in later tutorials.</p>
<h3 id="code-for-domino-6">Code For Domino 6</h3>
<p>The hiccup returned by the view function 
is made into real browser DOM by Reagent/React. No code from you required. Just happens.</p>
<p>The DOM computed &quot;this
time&quot; will be the same as &quot;last time&quot;, <strong>except</strong> for the absence of DOM for the
deleted item, so the mutation will be to remove those now-missing
DOM nodes from the browser.</p>
<h3 id="3-4-5-6-summary">3-4-5-6 Summary</h3>
<p>The key point to understand about our 3-4-5-6 example is:</p>
<ul>
<li>a change to app state ...</li>
<li>triggers query functions to rerun ...</li>
<li>which triggers view functions to rerun</li>
<li>which causes modified browser DOM </li>
</ul>
<p>Boom, boom, boom go the dominoes. It is a reactive data flow.</p>
<h3 id="aaaaand-were-done">Aaaaand we&apos;re done</h3>
<p>At this point, the re-frame app returns to a quiescent state, 
waiting for the next event.</p>
<h2 id="so-your-job-is-">So, your job is ...</h2>
<p>When building a re-frame app, you:</p>
<ul>
<li>design your app&apos;s information model (data and schema layer)</li>
<li>write and register event handler functions  (control and transition layer)  (domino 2)</li>
<li>(once in a blue moon) write and register effect and coeffect handler
functions (domino 3) which do the mutative dirty work of which we dare not
speak. </li>
<li>write and register query functions which implement nodes in a signal graph (query layer) (domino 4)</li>
<li>write Reagent view functions  (view layer)  (domino 5)</li>
</ul>
<h2 id="re-frame-is-mature-and-proven-in-the-large">re-frame is mature and proven in the large</h2>
<p>re-frame was released in early 2015, and has since 
<a href="https://www.fullcontact.com" target="_blank">been</a> successfully
<a href="https://www.nubank.com.br" target="_blank">used</a> by
<a href="http://open.mediaexpress.reuters.com/" target="_blank">quite</a> a 
<a href="https://rokt.com/" target="_blank">few</a> companies and
individuals to build complex apps, many running beyond 40K lines of
ClojureScript.</p>
<p><img align="right" src="re-frame/images/scale-changes-everything.jpg?raw=true"></p>
<p><strong>Scale changes everything.</strong> Frameworks
are just pesky overhead at small scale - measure them instead by how they help
you tame the complexity of bigger apps, and in this regard re-frame has
worked out well. Some have been effusive in their praise.</p>
<p>Having said that, re-frame remains a work in progress and it falls
short in a couple of ways - for example it doesn&apos;t work as well as we&apos;d
like with devcards, because it is a framework, rather than a library. 
We&apos;re still puzzling over some aspects and tweaking as we go. All designs
represent a point in the possible design space, with pros and cons.</p>
<p>And, yes, re-frame is fast, straight out of the box. And, yes, it has 
a good testing story (unit and behavioural). And, yes, it works with figwheel to create
a powerful hot-loading development story. And, yes, it has 
fun specialist tooling, and a community,
and useful 3rd party libraries.</p>
<h2 id="where-do-i-go-next">Where Do I Go Next?</h2>
<p>At this point, you know 50% of re-frame. The full <a href="re-frame/docs/README.md">docs are here</a>.  </p>
<p>There are two example apps to play with: <br>
<a href="https://github.com/Day8/re-frame/tree/master/examples" target="_blank">https://github.com/Day8/re-frame/tree/master/examples</a></p>
<p>Use a template to create your own project: <br>
Client only:  <a href="https://github.com/Day8/re-frame-template" target="_blank">https://github.com/Day8/re-frame-template</a>  <br>
Full Stack: <a href="http://www.luminusweb.net/" target="_blank">http://www.luminusweb.net/</a></p>
<p>And please be sure to review these further resources: <br>
<a href="https://github.com/Day8/re-frame/blob/master/docs/External-Resources.md" target="_blank">https://github.com/Day8/re-frame/blob/master/docs/External-Resources.md</a></p>
<h3 id="t-shirt-unlocked">T-Shirt Unlocked</h3>
<p>Good news.  If you&apos;ve read this far,
your insiders T-shirt will be arriving soon - it will feature turtles, 
<a href="http://xkcd.com/1416/" target="_blank">xkcd</a> and something about &quot;data all the way down&quot;. 
But we&apos;re still working on the hilarious caption bit. Open a
repo issue with a suggestion.</p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="re-frame/" class="navigation navigation-prev " aria-label="Previous page: Introduction">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="re-frame/ApplicationState.html" class="navigation navigation-next " aria-label="Next page: app-db (Application State)">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"This Repo's README","level":"2.1","depth":1,"next":{"title":"app-db (Application State)","level":"2.2","depth":1,"path":"ApplicationState.md","ref":"ApplicationState.md","articles":[]},"previous":{"title":"Introduction","level":"1.1","depth":1,"path":"README.md","ref":"README.md","articles":[]},"dir":"ltr"},"config":{"plugins":[],"root":"./docs/","styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"README.md"},"variables":{},"title":"re-frame","language":"en","gitbook":"*","description":"Documentation of re-frame framework"},"file":{"path":"../README.md","mtime":"2017-09-21T10:24:52.721Z","type":"markdown"},"gitbook":{"version":"3.2.2","time":"2017-09-21T10:34:13.106Z"},"basePath":"re-frame","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="re-frame/gitbook/gitbook.js"></script>
    <script src="re-frame/gitbook/theme.js"></script>
    
        
        <script src="re-frame/gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="re-frame/gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="re-frame/gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="re-frame/gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="re-frame/gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="re-frame/gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

