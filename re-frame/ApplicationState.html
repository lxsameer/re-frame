
<!DOCTYPE HTML>
<html lang="en" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>app-db (Application State) Â· re-frame</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.2">
        
        
        
    
    <link rel="stylesheet" href="gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="CodeWalkthrough.html" />
    
    
    <link rel="prev" href="../" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        <li class="header">description: re-frame official documentation</li>
        
        
    
        <li class="chapter " data-level="1.1" data-path="./">
            
                <a href="./">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Derived Values, Flowing</li>
        
        
    
        <li class="chapter " data-level="2.1" data-path="../">
            
                <a href="../">
            
                    
                    This Repo's README
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="2.2" data-path="ApplicationState.html">
            
                <a href="ApplicationState.html">
            
                    
                    app-db (Application State)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3" data-path="CodeWalkthrough.html">
            
                <a href="CodeWalkthrough.html">
            
                    
                    First Code Walk-Through
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.4" data-path="API.html">
            
                <a href="API.html">
            
                    
                    The API
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.5" data-path="MentalModelOmnibus.html">
            
                <a href="MentalModelOmnibus.html">
            
                    
                    Mental Model Omnibus
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Alternative Introductions</li>
        
        
    
        <li class="chapter " data-level="3.1" >
            
                <a target="_blank" href="https://purelyfunctional.tv/guide/re-frame-building-blocks/">
            
                    
                    purelyfunctional.tv
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2" >
            
                <a target="_blank" href="https://lambdaisland.com/episodes">
            
                    
                    Lambda Island Videos
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Dominoes 2 and 3 - Event Handlers</li>
        
        
    
        <li class="chapter " data-level="4.1" data-path="EventHandlingInfographic.html">
            
                <a href="EventHandlingInfographic.html">
            
                    
                    Infographic Overview
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.2" data-path="EffectfulHandlers.html">
            
                <a href="EffectfulHandlers.html">
            
                    
                    Effectful Handlers
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.3" data-path="Interceptors.html">
            
                <a href="Interceptors.html">
            
                    
                    Interceptors
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.4" data-path="Effects.html">
            
                <a href="Effects.html">
            
                    
                    Effects
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.5" data-path="Coeffects.html">
            
                <a href="Coeffects.html">
            
                    
                    Coeffects
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Domino 4 - Subscriptions</li>
        
        
    
        <li class="chapter " data-level="5.1" data-path="SubscriptionInfographic.html">
            
                <a href="SubscriptionInfographic.html">
            
                    
                    Infographic
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.2" data-path="SubscriptionsCleanup.html">
            
                <a href="SubscriptionsCleanup.html">
            
                    
                    Correcting a wrong
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.3" data-path="SubscriptionFlow.html">
            
                <a href="SubscriptionFlow.html">
            
                    
                    Flow Mechanics
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Domino 5 - Reagent Tutorials</li>
        
        
    
        <li class="chapter " data-level="6.1" >
            
                <a target="_blank" href="https://github.com/Day8/re-frame/wiki#reagent-tutorials">
            
                    
                    The Basics
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.2" >
            
                <a target="_blank" href="https://lambdaisland.com/episodes">
            
                    
                    Lambda Island Videos
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.3" >
            
                <a target="_blank" href="https://purelyfunctional.tv/guide/reagent/">
            
                    
                    purelyfunctional.tv 
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.4" >
            
                <a target="_blank" href="http://timothypratley.blogspot.com.au/p/p.html">
            
                    
                    Reagent Deep Dive Series from Timothy Pratley
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.5" >
            
                <a target="_blank" href="https://www.martinklepsch.org/posts/props-children-and-component-lifecycle-in-reagent.html">
            
                    
                    Props, Children & Component Lifecycle
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">App Structure</li>
        
        
    
        <li class="chapter " data-level="7.1" data-path="Basic-App-Structure.html">
            
                <a href="Basic-App-Structure.html">
            
                    
                    Basic App Structure
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="7.2" data-path="Navigation.html">
            
                <a href="Navigation.html">
            
                    
                    Navigation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="7.3" data-path="Namespaced-Keywords.html">
            
                <a href="Namespaced-Keywords.html">
            
                    
                    Namespaced Keywords
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">App Data</li>
        
        
    
        <li class="chapter " data-level="8.1" data-path="Loading-Initial-Data.html">
            
                <a href="Loading-Initial-Data.html">
            
                    
                    Loading Initial Data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="8.2" data-path="Talking-To-Servers.html">
            
                <a href="Talking-To-Servers.html">
            
                    
                    Talking To Servers
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="8.3" data-path="Subscribing-To-External-Data.html">
            
                <a href="Subscribing-To-External-Data.html">
            
                    
                    Subscribing to External Data
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Debugging And Testing</li>
        
        
    
        <li class="chapter " data-level="9.1" data-path="Debugging-Event-Handlers.html">
            
                <a href="Debugging-Event-Handlers.html">
            
                    
                    Debugging Event Handlers
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="9.2" data-path="Debugging.html">
            
                <a href="Debugging.html">
            
                    
                    Debugging
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="9.3" data-path="Testing.html">
            
                <a href="Testing.html">
            
                    
                    Testing
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Miscellaneous</li>
        
        
    
        <li class="chapter " data-level="10.1" data-path="FAQs/">
            
                <a href="FAQs/">
            
                    
                    FAQs
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="10.2" data-path="External-Resources.html">
            
                <a href="External-Resources.html">
            
                    
                    External Resources
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="10.3" data-path="Performance-Problems.html">
            
                <a href="Performance-Problems.html">
            
                    
                    Eek! Performance Problems
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="10.4" data-path="Solve-the-CPU-hog-problem.html">
            
                <a href="Solve-the-CPU-hog-problem.html">
            
                    
                    Solve the CPU hog problem
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="10.5" data-path="Using-Stateful-JS-Components.html">
            
                <a href="Using-Stateful-JS-Components.html">
            
                    
                    Using Stateful JS Components
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="10.6" data-path="The-re-frame-logo.html">
            
                <a href="The-re-frame-logo.html">
            
                    
                    The re-frame Logo
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="10.7" data-path="Code-Of-Conduct.html">
            
                <a href="Code-Of-Conduct.html">
            
                    
                    Code Of Conduct
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="." >app-db (Application State)</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h2 id="application-state">Application State</h2>
<div style="width:400px">
  <blockquote class="twitter-tweet" lang="en"><p>Well-formed Data at rest is as close to perfection in programming as it gets. All the crap that had to happen to put it there however...</p>&#x2014; Fogus (@fogus) <a href="https://twitter.com/fogus/status/454582953067438080" target="_blank">April 11, 2014</a></blockquote>
</div>

<h3 id="the-big-ratom">The Big Ratom</h3>
<p>re-frame puts all your application state into one place, which is
called <code>app-db</code>.</p>
<p>Ideally, you will provide a spec for this data-in-the-one-place,
<a href="http://clojure.org/about/spec" target="_blank">using a powerful and leverageable schema</a>.</p>
<p>Now, this advice is not the slightest bit controversial for &apos;real&apos; databases, right?
You&apos;d happily put all your well-formed data into PostgreSQL.</p>
<p>But within a running application (in memory), there can be hesitation. If you have
a background in OO, this data-in-one-place
business is a really, really hard one to swallow.  You&apos;ve
spent your life breaking systems into pieces, organised around behaviour and trying
to hide state.  I still wake up in a sweat some nights thinking about all
that Clojure data lying around exposed and passive.</p>
<p>But, as Fogus reminds us, data at rest is quite perfect.</p>
<p>In re-frame, <code>app-db</code> is one of these:</p>
<pre><code class="lang-clj">(<span class="hljs-name"><span class="hljs-builtin-name">def</span></span> app-db  (<span class="hljs-name">reagent/atom</span> {}))    <span class="hljs-comment">;; a Reagent atom, containing a map</span>
</code></pre>
<p>Although it is a <code>Reagent atom</code> (hereafter <code>ratom</code>), I&apos;d encourage
you to think of it as an in-memory database. It will contain structured data.
You will need to query that data. You will perform CRUD
and other transformations on it. You&apos;ll often want to transact on this
database atomically, etc.  So &quot;in-memory database&quot;
seems a more useful paradigm than plain old map-in-atom.</p>
<p>Further Notes:</p>
<ol>
<li><code>app-state</code> would probably be a more accurate name, but I choose <code>app-db</code> instead because
 I wanted to convey the in-memory database notion as strongly as possible.</li>
<li>In the documentation and code, I make a distinction between <code>app-db</code> (the <code>ratom</code>) and
<code>db</code> which is the (map) <code>value</code> currently stored <strong>inside</strong> this <code>ratom</code>. Be aware of that naming as you read code.</li>
<li>re-frame creates and manages an <code>app-db</code> for you, so
you don&apos;t need to declare one yourself (see the <a href="FAQs/Inspecting-app-db.md">the first FAQ</a> if you want
to inspect the value it holds).</li>
<li><code>app-db</code> doesn&apos;t actually have to be a <code>ratom</code> containing a map.  It could, for example,
be a <a href="https://github.com/tonsky/datascript" target="_blank">datascript database</a>.  In fact, any database which
can signal you when it changes would do. We&apos;d love! to be using <a href="https://github.com/tonsky/datascript" target="_blank">datascript database</a> - so damn cool -
but we had too much data in our apps. If you were to use it, you&apos;d have to tweak re-frame a bit and use <a href="https://github.com/mpdairy/posh" target="_blank">Posh</a>.</li>
</ol>
<h3 id="the-benefits-of-data-in-the-one-place">The Benefits Of Data-In-The-One-Place</h3>
<ol>
<li><p>Here&apos;s the big one:  because there is a single source of truth, we write no
code to synchronise state between many different stateful components.  I
cannot stress enough how significant this is. You end up writing less code
and an entire class of bugs is eliminated.
(This mindset is very different to OO which involves
distributing state across objects, and then ensuring that state is synchronised, all the while
trying to hide it, which is, when you think about it, quite crazy ... and I did it for years).</p>
</li>
<li><p>Because all app state is coalesced into one atom, it can be updated
with a single <code>reset!</code>, which acts like a transactional commit. There is
an instant in which the app goes from one state to the next, never a series
of incremental steps which can leave the app in a temporarily inconsistent, intermediate state.
Again, this simplicity causes a certain class of bugs or design problems to evaporate.</p>
</li>
<li><p>The data in <code>app-db</code> can be given a strong schema
so that, at any moment, we can validate all the data in the application. <strong>All of it!</strong>
We do this check after every single &quot;event handler&quot; runs (event handlers compute new state).
And this enables us to catch errors early (and accurately). It increases confidence in the way
that Types can increase confidence, only <a href="https://www.youtube.com/watch?v=nqY4nUMfus8" target="_blank">a good schema can potentially provide more
<strong>leverage</strong> than types</a>.</p>
</li>
<li><p>Undo/Redo <a href="https://github.com/Day8/re-frame-undo" target="_blank">becomes straight forward to implement</a>.
It is easy to snapshot and restore one central value. Immutable data structures have a
feature called <code>structural sharing</code> which means it doesn&apos;t cost much RAM to keep the last, say, 200<br>snapshots. All very efficient.
For certain categories of applications (eg: drawing applications) this feature is borderline magic.
Instead of undo/redo being hard, disruptive and error prone, it becomes trivial.
<strong>But,</strong> many web applications are not self contained
data-wise and, instead, are dominated by data sourced from an authoritative, remote database.
For these applications, re-frame&apos;s <code>app-db</code> is mostly a local caching
point, and being able to do undo/redo its state is meaningless because the authoritative
source of data is elsewhere.</p>
</li>
<li><p>The ability to genuinely model control via FSMs (discussed later).</p>
</li>
<li><p>The ability to do time travel debugging, even in a production setting. More soon.</p>
</li>
</ol>
<h3 id="create-a-leveragable-schema">Create A Leveragable Schema</h3>
<p>You need to create a <a href="http://clojure.org/about/spec" target="_blank">spec</a> schema for <code>app-db</code>. You want that leverage.</p>
<p>Of course, that means you&apos;ll have to learn <a href="http://clojure.org/about/spec" target="_blank">spec</a> and there&apos;s
some overhead in that, so maybe, just maybe, in your initial experiments, you can
get away without one. But not for long.  Promise me you&apos;ll write a <code>spec</code>.  Promise me.  Okay, good.</p>
<p>Soon we&apos;ll look at the <a href="https://github.com/Day8/re-frame/tree/master/examples/todomvc" target="_blank">todomvc example</a>
which shows how to use a spec.  (Check out <code>src/db.cljs</code> for the spec itself, and then in <code>src/events.cljs</code> for
how to write code which checks <code>app-db</code> against this spec after every single event has been
processed.)</p>
<p>Specs are potentially more  leveragable than types. This is a big interesting idea which is not yet mainstream.
Watch how: <br>
<a href="https://www.youtube.com/watch?v=VNTQ-M_uSo8" target="_blank">https://www.youtube.com/watch?v=VNTQ-M_uSo8</a></p>
<p>Also, watch the mighty Rich Hickey (poor audio):<br>
<a href="https://vimeo.com/195711510" target="_blank">https://vimeo.com/195711510</a></p>
<h3 id="how-do-i-inspect-it">How do I inspect it?</h3>
<p>See <a href="FAQs/Inspecting-app-db.md">FAQ #1</a></p>
<hr>
<p>Previous:  <a href="../">This Repo&apos;s README</a>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;
Up:  <a href="./">Index</a>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;
Next:  <a href="CodeWalkthrough.html">First Code Walk-Through</a></p>
<!-- START doctoc generated TOC please keep comment here to allow auto update -->
<!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE -->
<!-- END doctoc generated TOC please keep comment here to allow auto update -->

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="../" class="navigation navigation-prev " aria-label="Previous page: This Repo's README">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="CodeWalkthrough.html" class="navigation navigation-next " aria-label="Next page: First Code Walk-Through">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"app-db (Application State)","level":"2.2","depth":1,"next":{"title":"First Code Walk-Through","level":"2.3","depth":1,"path":"CodeWalkthrough.md","ref":"CodeWalkthrough.md","articles":[]},"previous":{"title":"This Repo's README","level":"2.1","depth":1,"path":"../README.md","ref":"../README.md","articles":[]},"dir":"ltr"},"config":{"plugins":[],"root":"./docs/","styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"README.md"},"variables":{},"title":"re-frame","language":"en","gitbook":"*","description":"Documentation of re-frame framework"},"file":{"path":"ApplicationState.md","mtime":"2017-09-21T10:24:52.721Z","type":"markdown"},"gitbook":{"version":"3.2.2","time":"2017-09-21T10:34:13.106Z"},"basePath":".","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="gitbook/gitbook.js"></script>
    <script src="gitbook/theme.js"></script>
    
        
        <script src="gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

